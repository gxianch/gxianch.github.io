<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="常见问题及解决办法打开文件数过多Too many open files解决办法： 1.修改系统参数，增加最大文件数 出现red索引解决办法： 1.查看unassigned分片(没有生成副本导致unassigned状态不在此列），获取unassigned的索引和分片 12345curl -u admin:admin http:&#x2F;&#x2F;192.168.199.101:9200&amp;#x2F">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch常见问题及解决办法">
<meta property="og:url" content="http://yoursite.com/2020/01/03/Elasticsearch%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/index.html">
<meta property="og:site_name" content="g.xian 的博客">
<meta property="og:description" content="常见问题及解决办法打开文件数过多Too many open files解决办法： 1.修改系统参数，增加最大文件数 出现red索引解决办法： 1.查看unassigned分片(没有生成副本导致unassigned状态不在此列），获取unassigned的索引和分片 12345curl -u admin:admin http:&#x2F;&#x2F;192.168.199.101:9200&amp;#x2F">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp">
<meta property="og:image" content="http://yoursite.com/2020/01/03/Elasticsearch%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp">
<meta property="og:image" content="http://yoursite.com/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch10.bmp">
<meta property="og:image" content="http://yoursite.com/2020/01/03/Elasticsearch%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch10.bmp">
<meta property="article:published_time" content="2020-01-03T00:46:01.000Z">
<meta property="article:modified_time" content="2023-09-19T10:00:26.211Z">
<meta property="article:author" content="g.xian">
<meta property="article:tag" content="大数据">
<meta property="article:tag" content="编程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp">

<link rel="canonical" href="http://yoursite.com/2020/01/03/Elasticsearch%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Elasticsearch常见问题及解决办法 | g.xian 的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">g.xian 的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">阅读书籍笔记,不定期更新</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home  //首页"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive   //归档"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags   //标签"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th  //分类"></i>分类</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/03/Elasticsearch%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="g.xian">
      <meta itemprop="description" content="hexo cl&&hexo g&& hexo d本地hexo s">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="g.xian 的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Elasticsearch常见问题及解决办法
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-03 08:46:01" itemprop="dateCreated datePublished" datetime="2020-01-03T08:46:01+08:00">2020-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-19 18:00:26" itemprop="dateModified" datetime="2023-09-19T18:00:26+08:00">2023-09-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">elasticsearch</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="常见问题及解决办法"><a href="#常见问题及解决办法" class="headerlink" title="常见问题及解决办法"></a>常见问题及解决办法</h2><h5 id="打开文件数过多Too-many-open-files"><a href="#打开文件数过多Too-many-open-files" class="headerlink" title="打开文件数过多Too many open files"></a>打开文件数过多Too many open files</h5><p>解决办法：<br> 1.修改系统参数，增加最大文件数</p>
<h5 id="出现red索引"><a href="#出现red索引" class="headerlink" title="出现red索引"></a>出现red索引</h5><p>解决办法：<br> 1.查看unassigned分片(没有生成副本导致unassigned状态不在此列），获取unassigned的索引和分片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin http:&#x2F;&#x2F;192.168.199.101:9200&#x2F;_cat&#x2F;shards |grep UNASSIGNED</span><br><span class="line">shsnc-snc_redis_rule_data 0 p UNASSIGNED                             </span><br><span class="line">shsnc-snc_redis_rule_data 0 r UNASSIGNED </span><br><span class="line"></span><br><span class="line">索引是shsnc-snc_redis_rule_data,分片0主副分片未分配</span><br></pre></td></tr></table></figure>

<p>2.查询得到master节点的唯一标识符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin  http:&#x2F;&#x2F;192.168.199.101:9200&#x2F;_cat&#x2F;master?v</span><br><span class="line">id                     host            ip              node</span><br><span class="line">WACuWE4UTcSWWxAEKHbwUg 192.168.199.101 192.168.199.101 es192.168.199.101_1</span><br></pre></td></tr></table></figure>

<p>3重新路由reroute </p>
<p>3.1根据索引index和分片shard 先尝试恢复数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin  -H &quot;Content-Type: application&#x2F;json&quot; -XPOST &#39;http:&#x2F;&#x2F;192.168.199.101:9200&#x2F;_cluster&#x2F;reroute?pretty&#39; -d &#39;&#123;&quot;commands&quot;:[&#123;&quot;allocate_stale_primary&quot;:&#123;&quot;index&quot;:&quot;shsnc-snc_redis_rule_data&quot;,&quot;shard&quot;:0,&quot;node&quot;:&quot;KOSdc1s0T661o9xgsEHHBQ&quot;,&quot;accept_data_loss&quot;:true&#125;&#125;]&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>3.2如果不能恢复，则创建空主分片，使索引恢复GREEN状态 （节点id要求是数据节点）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -H &#39;Content-Type:application&#x2F;json&#39; -XPOST  &#39;http:&#x2F;&#x2F;192.168.199.101:9200&#x2F;_cluster&#x2F;reroute?pretty&#39; -d &#39;&#123;&quot;commands&quot;:[&#123;&quot;allocate_empty_primary&quot;:&#123;&quot;index&quot;:&quot;shsnc-snc_redis_rule_data&quot;,&quot;shard&quot;:0,&quot;node&quot;:&quot;WACuWE4UTcSWWxAEKHbwUg&quot;,&quot;accept_data_loss&quot;:true&#125;&#125;]&#125;&#39;</span><br></pre></td></tr></table></figure>



<h5 id="超过单个字段最大长度32766"><a href="#超过单个字段最大长度32766" class="headerlink" title="超过单个字段最大长度32766"></a>超过单个字段最大长度32766</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ava.lang.IllegalArgumentException: Document contains at least one immense term in field&#x3D;&quot;groupTemplateValue&quot; </span><br><span class="line">(whose UTF8 encoding is longer than the max length 32766), all of which were skipped.  Please correct the analyzer </span><br><span class="line">to not produce such terms.  The prefix of the first immense term is: &#39;[102, 114, 111, 109, 32, 58, 32, 42, 32, 44, 10, </span><br><span class="line">42, 32, 58, 32, 36, 78, 85, 77, 32, 44, 10, 98, 111, 111, 108, 32, 58, 32, 123]...&#39;, original message: bytes can be at most </span><br><span class="line">32766 in length; got 102464</span><br></pre></td></tr></table></figure>
<p>分析：此问题仅对keyword类型字段<br>解决办法：<br>1.更换字段类型为text,<br>2.添加ignore_above设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;raw_message&quot;: &#123;</span><br><span class="line">&quot;ignore_above&quot;: 10000,</span><br><span class="line">&quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="任务超出队列-拒绝请求"><a href="#任务超出队列-拒绝请求" class="headerlink" title="任务超出队列,拒绝请求"></a>任务超出队列,拒绝请求</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error&quot;:&#123;&quot;root_cause&quot;:[&#123;&quot;type&quot;:&quot;es_rejected_execution_exception&quot;,&quot;reason&quot;:&quot;rejected execution of org.elasticsearch.transport.TransportService$7@215f2351 on EsThreadPoolExecutor[name &#x3D; node-0&#x2F;bulk, queue capacity &#x3D; 200, org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor@587b75c[Running, pool size &#x3D; 32, active threads &#x3D; 32, queued tasks &#x3D; 200, completed tasks &#x3D; 98211]]&quot;&#125;],&quot;type&quot;:&quot;es_rejected_execution_exception&quot;,&quot;reason&quot;:&quot;rejected execution of org.elasticsearch.transport.TransportService$7@215f2351 on EsThreadPoolExecutor[name &#x3D; node-0&#x2F;bulk, queue capacity &#x3D; 200,</span><br></pre></td></tr></table></figure>
<p>默认值是200，可设置参数<br>thread_pool.write.queue_size: 1000<br>调参数是临时解决办法，需要扩容集群</p>
<h5 id="新加入机器到集群时，写入倾斜到新集群"><a href="#新加入机器到集群时，写入倾斜到新集群" class="headerlink" title="新加入机器到集群时，写入倾斜到新集群"></a>新加入机器到集群时，写入倾斜到新集群</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">The cluster-level shard allocator tries to spread the shards of a single index across as many nodes as possible. However, depending on how many shards and indices you have, and how big they are, it may not always be possible to spread shards evenly.</span><br><span class="line"></span><br><span class="line">The following *dynamic* setting allows you to specify a hard limit on the total number of shards from a single index allowed per node:</span><br><span class="line"></span><br><span class="line">    index.routing.allocation.total_shards_per_node</span><br><span class="line"></span><br><span class="line">  The maximum number of shards (replicas and primaries) that will be allocated to a single node. Defaults to unbounded.</span><br><span class="line"></span><br><span class="line">You can also limit the amount of shards a node can have regardless of the index:</span><br><span class="line"></span><br><span class="line">    cluster.routing.allocation.total_shards_per_node</span><br><span class="line"></span><br><span class="line">  The maximum number of shards (replicas and primaries) that will be allocated to a single node globally. Defaults to unbounded (-1).</span><br><span class="line"></span><br><span class="line">These settings impose a hard limit which can result in some shards not being allocated.</span><br><span class="line">  Use with caution.</span><br></pre></td></tr></table></figure>
<p>索引级别设置：单个机器上分配该索引多少个分片，默认无限制<br>集群级别设置：单个机器上总分片数，默认无限制<br>注意：设置不合理，可能导致分片无法分配，比如索引有10个分片，只有2个es节点，如果设置单个节点该索引最大值为3，就会导致该索引分片无法分配</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-total-shards.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-total-shards.html</a></p>
<h5 id="模糊查询导致堆栈溢出"><a href="#模糊查询导致堆栈溢出" class="headerlink" title="模糊查询导致堆栈溢出"></a>模糊查询导致堆栈溢出</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> asiainfo-ceshizhibiao-* <span class="keyword">where</span> cpu <span class="keyword">like</span> <span class="string">'%在迪士尼乐园，点亮心中奇梦。它是一个充满创造力、冒险精神与无穷精彩的快地。您可在此游览全球最大的迪士%'</span> </span><br><span class="line">DSL</span><br><span class="line">&#123;<span class="string">"from"</span>:<span class="number">0</span>,<span class="string">"size"</span>:<span class="number">1000</span>,<span class="string">"query"</span>:&#123;<span class="string">"bool"</span>:&#123;<span class="string">"filter"</span>:[&#123;<span class="string">"bool"</span>:&#123;<span class="string">"must"</span>:[&#123;<span class="string">"wildcard"</span>:&#123;<span class="string">"cpu"</span>:&#123;<span class="string">"wildcard"</span>:<span class="string">"*在迪士尼乐园，点亮心中奇梦。它是一个充满创造力、冒险精神与无穷精彩的快地。您可在此游览全球最大的迪士*"</span>,<span class="string">"boost"</span>:<span class="number">1.0</span>&#125;&#125;&#125;],<span class="string">"adjust_pure_negative"</span>:<span class="literal">true</span>,<span class="string">"boost"</span>:<span class="number">1.0</span>&#125;&#125;],<span class="string">"adjust_pure_negative"</span>:<span class="literal">true</span>,<span class="string">"boost"</span>:<span class="number">1.0</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>like中字段太长，导致堆栈溢出，目前like限制在30个字节</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[2017-06-14T21:06:39,330][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [xx.xx.xx.xx] fatal error in thread [elasticsearch[xx.xx.xx.xx][search][T#29]], exiting</span><br><span class="line">java.lang.StackOverflowError</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br></pre></td></tr></table></figure>
<h5 id="出现Can-not-be-imported-as-a-dangling-index-异常"><a href="#出现Can-not-be-imported-as-a-dangling-index-异常" class="headerlink" title="出现Can not be imported as a dangling index 异常"></a>出现Can not be imported as a dangling index 异常</h5><p><a href="https://discuss.elastic.co/t/how-to-resolve-dangling-indices-error-on-each-index/130609/11" target="_blank" rel="noopener">https://discuss.elastic.co/t/how-to-resolve-dangling-indices-error-on-each-index/130609/11</a><br>1.找到索引对应的uuid，<br>2.在报错的es节点上删除对应的本地存储nodes/0/indices/{uuid}文件</p>
<p><img src="/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp" alt=""></p>
<p><img src="Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp" alt=""></p>
<h5 id="出现Insufficient-buffer-remaining-for-AEAD-cipher-fragment-2-Needs-to-be-more-than-tag-size-16-异常"><a href="#出现Insufficient-buffer-remaining-for-AEAD-cipher-fragment-2-Needs-to-be-more-than-tag-size-16-异常" class="headerlink" title="出现Insufficient buffer remaining for AEAD cipher fragment (2). Needs to be more than tag size (16) 异常"></a>出现Insufficient buffer remaining for AEAD cipher fragment (2). Needs to be more than tag size (16) 异常</h5><p><img src="/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch10.bmp" alt=""><br><img src="Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch10.bmp" alt=""></p>
<p><a href="https://github.com/tkohegyi/mitmJavaProxy/issues/12" target="_blank" rel="noopener">https://github.com/tkohegyi/mitmJavaProxy/issues/12</a><br><a href="https://bugs.openjdk.org/browse/JDK-8221218" target="_blank" rel="noopener">https://bugs.openjdk.org/browse/JDK-8221218</a><br>今天es故障出现的原因是OpenJDK触发的bug，现在有两种处理方式，<br>一是继续观察，看后续还会不会触发，不触发就不用改，<br>二是更改jdk，更改jdk需要集群全量重启，更改jdk后会不会导致其它问题，也无法预测，目前集群gc已经很频繁，更改jdk也可能导致集群gc不过来出现内存溢出，目前更改jdk的风险比较高。<br>所以建议还是继续保持现状，做到再次遇到这种情况快速恢复，同时采集一些降低集群压力的措施（包括减少数据，延长刷新时间，查询方面等）,因为也有集群是采用的OpenJDK并没有出现这个bug。</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/03/Elasticsearch%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" rel="prev" title="Elasticsearch环境配置及常用命令">
      <i class="fa fa-chevron-left"></i> Elasticsearch环境配置及常用命令
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/03/Elasticsearch%E4%BB%8B%E7%BB%8D(%E5%9B%9B)/" rel="next" title="Elasticsearch介绍(四)">
      Elasticsearch介绍(四) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#常见问题及解决办法"><span class="nav-number">1.</span> <span class="nav-text">常见问题及解决办法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#打开文件数过多Too-many-open-files"><span class="nav-number">1.0.0.1.</span> <span class="nav-text">打开文件数过多Too many open files</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#出现red索引"><span class="nav-number">1.0.0.2.</span> <span class="nav-text">出现red索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#超过单个字段最大长度32766"><span class="nav-number">1.0.0.3.</span> <span class="nav-text">超过单个字段最大长度32766</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#任务超出队列-拒绝请求"><span class="nav-number">1.0.0.4.</span> <span class="nav-text">任务超出队列,拒绝请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#新加入机器到集群时，写入倾斜到新集群"><span class="nav-number">1.0.0.5.</span> <span class="nav-text">新加入机器到集群时，写入倾斜到新集群</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#模糊查询导致堆栈溢出"><span class="nav-number">1.0.0.6.</span> <span class="nav-text">模糊查询导致堆栈溢出</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#出现Can-not-be-imported-as-a-dangling-index-异常"><span class="nav-number">1.0.0.7.</span> <span class="nav-text">出现Can not be imported as a dangling index 异常</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#出现Insufficient-buffer-remaining-for-AEAD-cipher-fragment-2-Needs-to-be-more-than-tag-size-16-异常"><span class="nav-number">1.0.0.8.</span> <span class="nav-text">出现Insufficient buffer remaining for AEAD cipher fragment (2). Needs to be more than tag size (16) 异常</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="g.xian"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">g.xian</p>
  <div class="site-description" itemprop="description">hexo cl&&hexo g&& hexo d本地hexo s</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">147</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">113</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/gxianch" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gxianch" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/%E5%8F%91%E9%82%AE%E4%BB%B6%E8%87%B3:g.xian.ch@gmail.com" title="E-Mail → 发邮件至:g.xian.ch@gmail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://book4you.org/" title="https:&#x2F;&#x2F;book4you.org&#x2F;" rel="noopener" target="_blank">ZLibrary</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.banshujiang.cn/" title="http:&#x2F;&#x2F;www.banshujiang.cn&#x2F;" rel="noopener" target="_blank">banshujiang</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.packtpub.com/tech" title="https:&#x2F;&#x2F;www.packtpub.com&#x2F;tech" rel="noopener" target="_blank">packtpub</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.manning.com/" title="https:&#x2F;&#x2F;www.manning.com&#x2F;" rel="noopener" target="_blank">manning</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://coolshell.cn/" title="https:&#x2F;&#x2F;coolshell.cn&#x2F;" rel="noopener" target="_blank">coolshell</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">g.xian</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
