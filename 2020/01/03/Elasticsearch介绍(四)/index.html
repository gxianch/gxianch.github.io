<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="上一节介绍elasticsearch的插件，包括head, kibnan, ik分词,searchguard。 本节主要介绍elasticsearch的系统环境配置，es配置和一些操作和优化命令">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch介绍(四)">
<meta property="og:url" content="http://yoursite.com/2020/01/03/Elasticsearch%E4%BB%8B%E7%BB%8D(%E5%9B%9B)/index.html">
<meta property="og:site_name" content="g.xian 的博客">
<meta property="og:description" content="上一节介绍elasticsearch的插件，包括head, kibnan, ik分词,searchguard。 本节主要介绍elasticsearch的系统环境配置，es配置和一些操作和优化命令">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp">
<meta property="og:image" content="http://yoursite.com/2020/01/03/Elasticsearch%E4%BB%8B%E7%BB%8D(%E5%9B%9B)/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp">
<meta property="article:published_time" content="2020-01-03T00:46:01.000Z">
<meta property="article:modified_time" content="2023-09-19T09:08:40.483Z">
<meta property="article:author" content="g.xian">
<meta property="article:tag" content="大数据">
<meta property="article:tag" content="编程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp">

<link rel="canonical" href="http://yoursite.com/2020/01/03/Elasticsearch%E4%BB%8B%E7%BB%8D(%E5%9B%9B)/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Elasticsearch介绍(四) | g.xian 的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">g.xian 的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">阅读书籍笔记,不定期更新</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home  //首页"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive   //归档"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags   //标签"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th  //分类"></i>分类</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/03/Elasticsearch%E4%BB%8B%E7%BB%8D(%E5%9B%9B)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="g.xian">
      <meta itemprop="description" content="hexo cl&&hexo g&& hexo d本地hexo s">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="g.xian 的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Elasticsearch介绍(四)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-03 08:46:01" itemprop="dateCreated datePublished" datetime="2020-01-03T08:46:01+08:00">2020-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-19 17:08:40" itemprop="dateModified" datetime="2023-09-19T17:08:40+08:00">2023-09-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">elasticsearch</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>上一节介绍elasticsearch的插件，包括head, kibnan, ik分词,searchguard。</p>
<p>本节主要介绍elasticsearch的系统环境配置，es配置和一些操作和优化命令</p>
<a id="more"></a>

<h3 id="系统环境配置"><a href="#系统环境配置" class="headerlink" title="系统环境配置"></a>系统环境配置</h3><ol>
<li><p>/etc/sysctl.conf<br>#增加以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count&#x3D;6553600</span><br></pre></td></tr></table></figure>
<p>#永久关闭内存交换或设置为1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.swappiness &#x3D; 1</span><br></pre></td></tr></table></figure>
<p>执行以下命令，确保生效配置生效：<br>sysctl -p</p>
</li>
<li><p>/etc/security/limits.conf<br>#增加以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* soft nofile 6553600</span><br><span class="line">* hard nofile 6553600</span><br><span class="line">* soft nproc unlimited</span><br><span class="line">* hard nproc unlimited</span><br><span class="line">* soft memlock unlimited</span><br><span class="line">* hard memlock unlimited</span><br></pre></td></tr></table></figure></li>
<li><p>/etc/security/limits.d/20-nproc.conf<br>#增加以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* soft nproc 6553600</span><br></pre></td></tr></table></figure>
<p>查看打开文件数（当发现打开文件数不足时，可以用命令查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -u hnivory |wc -l</span><br></pre></td></tr></table></figure>
<h3 id="elasticsearch-yml配置"><a href="#elasticsearch-yml配置" class="headerlink" title="elasticsearch.yml配置"></a>elasticsearch.yml配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: es-cluster</span><br><span class="line">node.name: node1</span><br><span class="line">http.cors.enabled: true </span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br><span class="line">xpack.security.enabled: false</span><br><span class="line">searchguard.enterprise_modules_enabled: false</span><br><span class="line">searchguard.restapi.roles_enabled: [&quot;sg_all_access&quot;]</span><br><span class="line">searchguard.ssl.transport.enabled: true</span><br><span class="line">searchguard.ssl.transport.keystore_filepath: node-0-keystore.jks</span><br><span class="line">searchguard.ssl.transport.keystore_password: xxxxx</span><br><span class="line">searchguard.ssl.transport.truststore_filepath: truststore.jks</span><br><span class="line">searchguard.ssl.transport.truststore_password: xxxxx</span><br><span class="line">searchguard.ssl.transport.enforce_hostname_verification: false</span><br><span class="line">searchguard.ssl.transport.resolve_hostname: false</span><br><span class="line"></span><br><span class="line">searchguard.ssl.http.enabled: false</span><br><span class="line">#searchguard.ssl.http.keystore_filepath: node-0-keystore.jks</span><br><span class="line">#searchguard.ssl.http.keystore_password: xxxxx</span><br><span class="line">#searchguard.ssl.http.truststore_filepath: truststore.jks</span><br><span class="line">#searchguard.ssl.http.truststore_password: xxxxx</span><br><span class="line"></span><br><span class="line">searchguard.authcz.admin_dn:</span><br><span class="line"> - CN&#x3D;kirk,OU&#x3D;client,O&#x3D;client,L&#x3D;test,C&#x3D;DE</span><br><span class="line"></span><br><span class="line">#关闭searchguard,测试用</span><br><span class="line">searchguard.disabled: true</span><br><span class="line">indices.fielddata.cache.size: 40%</span><br><span class="line">node.max_local_storage_nodes: 2</span><br><span class="line">cluster.routing.allocation.same_shard.host: true</span><br><span class="line">bootstrap.memory_lock: true</span><br><span class="line">xpack.ml.enabled: false</span><br><span class="line">#action.destructive_requires_name: true</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;192.168.8.101:9300&quot;, &quot;192.168.8.103:9300&quot;, &quot;192.168.8.104:9300&quot;]  </span><br><span class="line">#这个参数控制的是，一个节点需要看到的具有master节点资格的最小数量，然后才能在集群中做操作。官方的推荐值是(N&#x2F;2)+1，其中N是具有master资格的节点的数量</span><br><span class="line">discovery.zen.minimum_master_nodes: 2 </span><br><span class="line">#控制集群在达到多少个节点之后才会开始数据恢复,通过这个设置可以避免集群自动相互发现的初期,shard分片不全的问题,假如es集群内一共有5个节点,就可以设置为5,那么这个集群必须有5个节点启动后才会开始数据分片,如果设置为3,就有可能另外两个节点没存储数据分片</span><br><span class="line">#gateway.recover_after_nodes: 1</span><br><span class="line">#初始化数据恢复的超时时间,假如gateway.recover_after_nodes参数设置为5,就是5个节点全部启动后,再过5分钟开始数据恢复</span><br><span class="line">#gateway.recover_after_time: 5m</span><br><span class="line">#启动几个节点后开始数据恢复,假如gateway.recover_after_nodes这个参数设置为5,那么等到这5个节点全部启动后直接可以数据恢复,不用等待gateway.recover_after_time设置的时间</span><br><span class="line">#gateway.expected_nodes: 2</span><br><span class="line">举例来说，对于一个有10个data node的集群，如果有以下的设置:</span><br><span class="line">#gateway.expected_data_nodes: 10</span><br><span class="line">#gateway.recover_after_time: 5m</span><br><span class="line">#gateway.recover_after_data_nodes: 8</span><br><span class="line">那么集群5分钟以内10个data node都加入了，或者5分钟以后8个以上的data node加入了，都会立即启动recovery过程。</span><br><span class="line">#配置在每轮ping操作中等待DNS查找的时间。这被指定为时间单位，默认为5秒。。</span><br><span class="line">#discovery.zen.ping.unicast.resolve_timeout</span><br><span class="line">#（默认为30s）确定节点将多久决定开始选举或加入现有的群集之前等待</span><br><span class="line"># discovery.zen.ping_timeout: 30s</span><br><span class="line">#How often a node gets pinged. Defaults to 1s.</span><br><span class="line">#ping_interval</span><br><span class="line">#How long to wait for a ping response, defaults to 30s.</span><br><span class="line">#ping_timeout</span><br><span class="line">#How many ping failures &#x2F; timeouts cause a node to be considered failed. Defaults to 3.</span><br><span class="line">#ping_retries</span><br><span class="line">#控制fielddata允许内存大小，达到HEAP 40% 自动清理旧cache</span><br><span class="line">#indices.fielddata.cache.size: 40%</span><br><span class="line">#防止同一个shard的主副本存在同一个物理机上（因为如果存在一个机器上，副本的高可用性就没有了</span><br><span class="line">#cluster.routing.allocation.same_shard.host:true</span><br><span class="line">#但仍允许os在紧急情况下发生交换。对于大部分Linux操作系统，可以在sysctl 中这样配置：#vm.swappiness &#x3D; 1，</span><br><span class="line">#临时修改sysctl vm.swappiness&#x3D;1 ， 永久修改，vi &#x2F;etc&#x2F;sysctl.conf  在这个文档的最后加上这样一行:vm.swappiness&#x3D;1,保存，重启</span><br><span class="line">#如果上面的方法都不能做到，你需要打开配置文件中的mlockall开关，它的作用就是运行JVM锁住内存，禁止OS交换出去。在elasticsearch.yml配置如下：bootstrap.mlockall: true</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>停止和开启分片分配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -X PUT localhost:9200&#x2F;_cluster&#x2F;settings &#123;&quot;persistent&quot;:&#123;&quot;cluster.routing.allocation.enable&quot;:&quot;none&quot;&#125;&#125;</span><br><span class="line">curl -u admin:admin -X PUT localhost:9200&#x2F;_cluster&#x2F;settings &#123;&quot;persistent&quot;:&#123;&quot;cluster.routing.allocation.enable&quot;:&quot;all&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>同步副本分片，刷新到磁盘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST http:&#x2F;&#x2F;127.0.0.1:9200&#x2F;_flush&#x2F;synced</span><br></pre></td></tr></table></figure>
<p>索引段强制合并为1个(<em>通配符表示全部，也可以具体的索引和其它通配符索引)，*</em>该操作会占用大量资源**，慎重操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPOST http:&#x2F;&#x2F;localhost:9200&#x2F;*&#x2F;_forcemerge?max_num_segments&#x3D;1</span><br></pre></td></tr></table></figure>
<p>统计节点个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_cat&#x2F;nodes  |wc-l</span><br></pre></td></tr></table></figure>
<p>获取节点状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_nodes&#x2F;stats?pretty</span><br></pre></td></tr></table></figure>
<p>查看索引分片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET http:&#x2F;&#x2F;localhost:9200&#x2F;_cat&#x2F;shards&#x2F;indexname</span><br></pre></td></tr></table></figure>
<p>设置节点离开重新分配时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  _all&#x2F;_settings PUT</span><br><span class="line">  &#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index.unassigned.node_left.delayed_timeout&quot;: &quot;5m&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看集群待处理任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_cluster&#x2F;pending_tasks</span><br></pre></td></tr></table></figure>
<p>最大文件描述符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_nodes&#x2F;stats&#x2F;process?filter_path&#x3D;**.max_file_descriptors</span><br></pre></td></tr></table></figure>
<p>关闭/开启监控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;_cluster&#x2F;settings   -H &#39;Content-Type: application&#x2F;json&#39; -d&#39;&#123;&quot;persistent&quot;: &#123;&quot;xpack.monitoring.collection.enabled&quot;: false&#125;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>模糊设置副本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;*-20191127&#x2F;_settings -H &#39;Content-Type:application&#x2F;json&#39;  -d&#39;&#123;&quot;index&quot;:&#123;&quot;number_of_replicas&quot;:0&#125;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>排除节点(根据ip,节点名称)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;_cluster&#x2F;settings  -H &#39;Content-Type: application&#x2F;json&#39; -d &#39;&#123;&quot;transient&quot;:&#123;&quot;cluster.routing.allocation.exclude._ip&quot;:&quot;10.159.102.43&quot;&#125;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>停止排除节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;_cluster&#x2F;settings  -H &#39;Content-Type: application&#x2F;json&#39; -d &#39;&#123;&quot;transient&quot;:&#123;&quot;cluster.routing.allocation.exclude._ip&quot;:&quot;&quot;&#125;&#125;&#39;</span><br><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;_cluster&#x2F;settings  -H &#39;Content-Type: application&#x2F;json&#39; -d &#39;&#123;&quot;transient&quot;:&#123;&quot;cluster.routing.allocation.exclude._name&quot;:&quot;&quot;&#125;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>查看磁盘分片分配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin localhost:9200&#x2F;_cluster&#x2F;allocation&#x2F;explain?pretty</span><br></pre></td></tr></table></figure>
<p>查看该节点任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_cat&#x2F;tasks</span><br></pre></td></tr></table></figure>
<p>查看节点任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_tasks?nodes&#x3D;esnode_10.159.102.45_9200</span><br><span class="line">  &#123;&quot;nodes&quot;:&#123;&quot;YKhjmEw6TP2d-VDCyxCvNA&quot;:&#123;&quot;name&quot;:&quot;esnode_10.159.102.45_9202&quot;,&quot;transport_address&quot;:&quot;10.159.102.45:9302&quot;,&quot;host&quot;:&quot;10.159.102.45&quot;,&quot;ip&quot;:&quot;10.159.102.45:9302&quot;,&quot;roles&quot;:[&quot;master&quot;,&quot;data&quot;,&quot;ingest&quot;],&quot;attributes&quot;:&#123;&quot;xpack.installed&quot;:&quot;true&quot;&#125;,&quot;tasks&quot;:&#123;&quot;YKhjmEw6TP2d-VDCyxCvNA:90113856&quot;:&#123;&quot;node&quot;:&quot;YKhjmEw6TP2d-VDCyxCvNA&quot;,&quot;id&quot;:90113856,&quot;type&quot;:&quot;netty&quot;,&quot;action&quot;:&quot;cluster:monitor&#x2F;tasks&#x2F;lists[n]&quot;,&quot;start_time_in_millis&quot;:1574855877228,&quot;running_time_in_nanos&quot;:541054,&quot;cancellable&quot;:false,&quot;parent_task_id&quot;:&quot;3WMnBj-pTNegdkT19ao5nQ:11035209&quot;,&quot;headers&quot;:&#123;&#125;&#125;&#125;&#125;&#125;&#125;[hnivory@data01 ~]</span><br></pre></td></tr></table></figure>
<p>取消任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin localhost:9200&#x2F;_tasks&#x2F;YKhjmEw6TP2d-VDCyxCvNA:90113856&#x2F;_cancel</span><br></pre></td></tr></table></figure>
<p>取消节点任务和某类型的任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_tasks&#x2F;_cancel?nodes&#x3D;esnode_10.159.102.43_9202,esnode_10.159.102.43_9203,esnode_10.159.102.43_9204,esnode_10.159.102.43_9205,&amp;actions&#x3D;cluster:*</span><br><span class="line">_tasks&#x2F;_cancel?nodes&#x3D;esnode_10.159.102.45_9202&amp;actions&#x3D;cluster:*   POST</span><br><span class="line">_tasks&#x2F;_cancel?nodes&#x3D;esnode_10.159.102.45_9202&amp;actions&#x3D;*reindex    POST</span><br></pre></td></tr></table></figure>
<p> 查看节点任务和某类型的任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_tasks?nodes&#x3D;esnode_10.159.102.45_9202&amp;actions&#x3D;cluster:*  GET</span><br></pre></td></tr></table></figure>

<h2 id="常见问题及解决办法"><a href="#常见问题及解决办法" class="headerlink" title="常见问题及解决办法"></a>常见问题及解决办法</h2><h5 id="打开文件数过多Too-many-open-files"><a href="#打开文件数过多Too-many-open-files" class="headerlink" title="打开文件数过多Too many open files"></a>打开文件数过多Too many open files</h5><p>解决办法：<br> 1.修改系统参数，增加最大文件数</p>
<h5 id="出现red索引"><a href="#出现red索引" class="headerlink" title="出现red索引"></a>出现red索引</h5><p>解决办法：<br> 1.查看unassigned分片(没有生成副本导致unassigned状态不在此列），获取unassigned的索引和分片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin http:&#x2F;&#x2F;localhost:9200&#x2F;_cat&#x2F;shards |grep UNASSIGNED</span><br><span class="line">shsnc-snc_redis_rule_data 0 p UNASSIGNED                             </span><br><span class="line">shsnc-snc_redis_rule_data 0 r UNASSIGNED </span><br><span class="line"></span><br><span class="line">索引shsnc-snc_redis_rule_data,分片0未分配</span><br></pre></td></tr></table></figure>

<p>2.查询得到master节点的唯一标识符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin  http:&#x2F;&#x2F;localhost:9200&#x2F;_cat&#x2F;master?v</span><br><span class="line">id                     host            ip              node</span><br><span class="line">WACuWE4UTcSWWxAEKHbwUg 192.168.199.101 192.168.199.101 es192.168.199.101_1</span><br><span class="line"></span><br><span class="line">master标识符WACuWE4UTcSWWxAEKHbwUg</span><br></pre></td></tr></table></figure>

<p>3重新路由reroute</p>
<p>3.1根据索引index和分片shard 先尝试恢复数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl –u admin:admin -H &#39;Content-Type:application&#x2F;json&#39; -XPOST  &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;_cluster&#x2F;reroute?pretty&#39; -d &#39;&#123;&quot;commands&quot;:[&#123;&quot;allocate_stale_primary&quot;:&#123;&quot;index&quot;:&quot;shsnc-snc_redis_rule_data&quot;,&quot;shard&quot;:0,&quot;node&quot;:&quot;WACuWE4UTcSWWxAEKHbwUg&quot;,&quot;accept_data_loss&quot;:true&#125;&#125;]&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>3.2如果不能恢复，则创建空主分片，使索引恢复GREEN状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl –u admin:admin -H &#39;Content-Type:application&#x2F;json&#39; -XPOST  &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;_cluster&#x2F;reroute?pretty&#39; -d &#39;&#123;&quot;commands&quot;:[&#123;&quot;allocate_empty_primary&quot;:&#123;&quot;index&quot;:&quot;shsnc-snc_redis_rule_data&quot;,&quot;shard&quot;:0,&quot;node&quot;:&quot;WACuWE4UTcSWWxAEKHbwUg&quot;,&quot;accept_data_loss&quot;:true&#125;&#125;]&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>方式二: <a href="https://discuss.elastic.co/t/corrupted-elastic-index/135932" target="_blank" rel="noopener">https://discuss.elastic.co/t/corrupted-elastic-index/135932</a></p>
<p>1.查找索引对应的uuid<br>curl -u  elastic:elastic 192.168.199.101:9207/_cat/indices?v<br>health status index                  uuid                   pri rep docs.count docs.deleted store.size pri.store.size<br>green  red   goods                  In3QTeHhQ0awvyhVEOI4Kg   1   1          1            0     12.1kb            6kb</p>
<p>#2.停止集群<br>3.CheckIndex tool<br><a href="https://lucene.apache.org/core/6_4_0/core/org/apache/lucene/index/CheckIndex.html#main-java.lang.String:A-" target="_blank" rel="noopener">https://lucene.apache.org/core/6_4_0/core/org/apache/lucene/index/CheckIndex.html#main-java.lang.String:A-</a><br>-exorcise: actually write a new segments_N file, removing any problematic segments. <em>LOSES DATA</em><br>-segment X: only check the specified segment(s). This can be specified multiple times, to check more than one segment, eg -segment _2 -segment _a. You can’t use this with the -exorcise option.<br>WARNING: -exorcise should only be used on an emergency basis as it will cause documents (perhaps many) to be permanently removed from the index. Always make a backup copy of your index before running this! Do not run this tool on an index that is actively being written to. You have been warned!<br>Run without -exorcise, this tool will open the index, report version information and report any exceptions it hits and what action it would take if -exorcise were specified. With -exorcise, this tool will remove any segments that have issues and write a new segments_N file. This means all documents contained in the affected segments will be removed.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;home&#x2F;ivory&#x2F;elasticsearch-7.2.0-9207&#x2F;lib</span><br><span class="line">#不带 -exorcise 检查段</span><br><span class="line">java -cp lucene-core*.jar -ea:org.apache.lucene… org.apache.lucene.index.CheckIndex &#x2F;home&#x2F;ivory&#x2F;elasticsearch-7.2.0-9207&#x2F;data&#x2F;nodes&#x2F;0&#x2F;indices&#x2F;In3QTeHhQ0awvyhVEOI4Kg&#x2F;0&#x2F;index -verbose</span><br><span class="line">#带 -exorcise 会重建段，需要先备份索引</span><br><span class="line">java -cp lucene-core*.jar -ea:org.apache.lucene… org.apache.lucene.index.CheckIndex &#x2F;home&#x2F;ivory&#x2F;elasticsearch-7.2.0-9207&#x2F;data&#x2F;nodes&#x2F;0&#x2F;indices&#x2F;In3QTeHhQ0awvyhVEOI4Kg&#x2F;0&#x2F;index -verbose -exorcise</span><br></pre></td></tr></table></figure>
<p>4.删除corrupted_*文件<br>5.重启集群</p>
<p>java -cp /home/ivory/elasticsearch-6.7.0-9200/lib/lucene-core*.jar -ea:org.apache.lucene… org.apache.lucene.index.CheckIndex /home/ivory/elasticsearch-6.7.0-9200/data/nodes/0/indices/Qpa0XlKdSXSoiYKLkvyRfA/0/index -verbose</p>
<p>java -cp /home/ivory/elasticsearch-6.7.0-9200/lib/lucene-core*.jar -ea:org.apache.lucene… org.apache.lucene.index.CheckIndex elasticsearch-6.7.0-9200/data/nodes/0/indices/STgHbPksRDyi0fBdk6Z70g/1/index -verbose</p>
<h5 id="超过单个字段最大长度32766"><a href="#超过单个字段最大长度32766" class="headerlink" title="超过单个字段最大长度32766"></a>超过单个字段最大长度32766</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ava.lang.IllegalArgumentException: Document contains at least one immense term in field&#x3D;&quot;groupTemplateValue&quot; </span><br><span class="line">(whose UTF8 encoding is longer than the max length 32766), all of which were skipped.  Please correct the analyzer </span><br><span class="line">to not produce such terms.  The prefix of the first immense term is: &#39;[102, 114, 111, 109, 32, 58, 32, 42, 32, 44, 10, </span><br><span class="line">42, 32, 58, 32, 36, 78, 85, 77, 32, 44, 10, 98, 111, 111, 108, 32, 58, 32, 123]...&#39;, original message: bytes can be at most </span><br><span class="line">32766 in length; got 102464</span><br></pre></td></tr></table></figure>
<p>分析：此问题仅对keyword类型字段<br>解决办法：<br>1.更换字段类型为text,<br>2.添加ignore_above设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;raw_message&quot;: &#123;</span><br><span class="line">&quot;ignore_above&quot;: 10000,</span><br><span class="line">&quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="任务超出队列-拒绝请求"><a href="#任务超出队列-拒绝请求" class="headerlink" title="任务超出队列,拒绝请求"></a>任务超出队列,拒绝请求</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error&quot;:&#123;&quot;root_cause&quot;:[&#123;&quot;type&quot;:&quot;es_rejected_execution_exception&quot;,&quot;reason&quot;:&quot;rejected execution of org.elasticsearch.transport.TransportService$7@215f2351 on EsThreadPoolExecutor[name &#x3D; node-0&#x2F;bulk, queue capacity &#x3D; 200, org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor@587b75c[Running, pool size &#x3D; 32, active threads &#x3D; 32, queued tasks &#x3D; 200, completed tasks &#x3D; 98211]]&quot;&#125;],&quot;type&quot;:&quot;es_rejected_execution_exception&quot;,&quot;reason&quot;:&quot;rejected execution of org.elasticsearch.transport.TransportService$7@215f2351 on EsThreadPoolExecutor[name &#x3D; node-0&#x2F;bulk, queue capacity &#x3D; 200,</span><br></pre></td></tr></table></figure>
<p>默认值是200，可设置参数<br>thread_pool.write.queue_size: 1000<br>调参数是临时解决办法，需要扩容集群</p>
<h5 id="新加入机器到集群时，写入倾斜到新集群"><a href="#新加入机器到集群时，写入倾斜到新集群" class="headerlink" title="新加入机器到集群时，写入倾斜到新集群"></a>新加入机器到集群时，写入倾斜到新集群</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">The cluster-level shard allocator tries to spread the shards of a single index across as many nodes as possible. However, depending on how many shards and indices you have, and how big they are, it may not always be possible to spread shards evenly.</span><br><span class="line"></span><br><span class="line">The following *dynamic* setting allows you to specify a hard limit on the total number of shards from a single index allowed per node:</span><br><span class="line"></span><br><span class="line">    index.routing.allocation.total_shards_per_node</span><br><span class="line"></span><br><span class="line">  The maximum number of shards (replicas and primaries) that will be allocated to a single node. Defaults to unbounded.</span><br><span class="line"></span><br><span class="line">You can also limit the amount of shards a node can have regardless of the index:</span><br><span class="line"></span><br><span class="line">    cluster.routing.allocation.total_shards_per_node</span><br><span class="line"></span><br><span class="line">  The maximum number of shards (replicas and primaries) that will be allocated to a single node globally. Defaults to unbounded (-1).</span><br><span class="line"></span><br><span class="line">These settings impose a hard limit which can result in some shards not being allocated.</span><br><span class="line">  Use with caution.</span><br></pre></td></tr></table></figure>
<p>索引级别设置：单个机器上分配该索引多少个分片，默认无限制<br>集群级别设置：单个机器上总分片数，默认无限制<br>注意：设置不合理，可能导致分片无法分配，比如索引有10个分片，只有2个es节点，如果设置单个节点该索引最大值为3，就会导致该索引分片无法分配</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-total-shards.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-total-shards.html</a></p>
<h5 id="模糊查询导致堆栈溢出"><a href="#模糊查询导致堆栈溢出" class="headerlink" title="模糊查询导致堆栈溢出"></a>模糊查询导致堆栈溢出</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> asiainfo-ceshizhibiao-* <span class="keyword">where</span> cpu <span class="keyword">like</span> <span class="string">'%在迪士尼乐园，点亮心中奇梦。它是一个充满创造力、冒险精神与无穷精彩的快地。您可在此游览全球最大的迪士%'</span></span><br></pre></td></tr></table></figure>
<p>like中字段太长，导致集群挂掉，目前like限制在30个字节</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[2017-06-14T21:06:39,330][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [xx.xx.xx.xx] fatal error in thread [elasticsearch[xx.xx.xx.xx][search][T#29]], exiting</span><br><span class="line">java.lang.StackOverflowError</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br></pre></td></tr></table></figure>
<h5 id="出现Can-not-be-imported-as-a-dangling-index-异常"><a href="#出现Can-not-be-imported-as-a-dangling-index-异常" class="headerlink" title="出现Can not be imported as a dangling index 异常"></a>出现Can not be imported as a dangling index 异常</h5><p><a href="https://discuss.elastic.co/t/how-to-resolve-dangling-indices-error-on-each-index/130609/11" target="_blank" rel="noopener">https://discuss.elastic.co/t/how-to-resolve-dangling-indices-error-on-each-index/130609/11</a><br>1.找到索引对应的uuid，<br>2.在报错的es节点上删除对应的本地存储nodes/0/indices/{uuid}文件</p>
<p><img src="/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp" alt=""></p>
<p><img src="Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp" alt=""></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/03/Elasticsearch%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" rel="prev" title="Elasticsearch环境配置及常用命令">
      <i class="fa fa-chevron-left"></i> Elasticsearch环境配置及常用命令
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/06/Storm-Spark-Flink%E5%AF%B9%E6%AF%94%E5%8F%8A%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/" rel="next" title="Storm-Spark-Flink对比及大数据技术选型">
      Storm-Spark-Flink对比及大数据技术选型 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#系统环境配置"><span class="nav-number">1.</span> <span class="nav-text">系统环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#elasticsearch-yml配置"><span class="nav-number">2.</span> <span class="nav-text">elasticsearch.yml配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用命令"><span class="nav-number">3.</span> <span class="nav-text">常用命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常见问题及解决办法"><span class="nav-number"></span> <span class="nav-text">常见问题及解决办法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#打开文件数过多Too-many-open-files"><span class="nav-number">0.0.1.</span> <span class="nav-text">打开文件数过多Too many open files</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#出现red索引"><span class="nav-number">0.0.2.</span> <span class="nav-text">出现red索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#超过单个字段最大长度32766"><span class="nav-number">0.0.3.</span> <span class="nav-text">超过单个字段最大长度32766</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#任务超出队列-拒绝请求"><span class="nav-number">0.0.4.</span> <span class="nav-text">任务超出队列,拒绝请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#新加入机器到集群时，写入倾斜到新集群"><span class="nav-number">0.0.5.</span> <span class="nav-text">新加入机器到集群时，写入倾斜到新集群</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#模糊查询导致堆栈溢出"><span class="nav-number">0.0.6.</span> <span class="nav-text">模糊查询导致堆栈溢出</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#出现Can-not-be-imported-as-a-dangling-index-异常"><span class="nav-number">0.0.7.</span> <span class="nav-text">出现Can not be imported as a dangling index 异常</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="g.xian"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">g.xian</p>
  <div class="site-description" itemprop="description">hexo cl&&hexo g&& hexo d本地hexo s</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">148</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">112</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/gxianch" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gxianch" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/%E5%8F%91%E9%82%AE%E4%BB%B6%E8%87%B3:g.xian.ch@gmail.com" title="E-Mail → 发邮件至:g.xian.ch@gmail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://book4you.org/" title="https:&#x2F;&#x2F;book4you.org&#x2F;" rel="noopener" target="_blank">ZLibrary</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.banshujiang.cn/" title="http:&#x2F;&#x2F;www.banshujiang.cn&#x2F;" rel="noopener" target="_blank">banshujiang</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.packtpub.com/tech" title="https:&#x2F;&#x2F;www.packtpub.com&#x2F;tech" rel="noopener" target="_blank">packtpub</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.manning.com/" title="https:&#x2F;&#x2F;www.manning.com&#x2F;" rel="noopener" target="_blank">manning</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://coolshell.cn/" title="https:&#x2F;&#x2F;coolshell.cn&#x2F;" rel="noopener" target="_blank">coolshell</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">g.xian</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
