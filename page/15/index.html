<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="郭富城的博客">
<meta property="og:url" content="http://yoursite.com/page/15/index.html">
<meta property="og:site_name" content="郭富城的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="郭富城">
<meta property="article:tag" content="大数据">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="读书">
<meta property="article:tag" content="随笔">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/15/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>郭富城的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">郭富城的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">阅读书籍笔记,不定期更新</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home  //首页"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive   //归档"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags   //标签"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th  //分类"></i>分类</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/06/Flume%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E6%B5%B7%E9%87%8F%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="郭富城">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郭富城的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/06/Flume%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E6%B5%B7%E9%87%8F%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">Flume构建高可用可扩展的海量日志采集系统</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-06 14:40:03" itemprop="dateCreated datePublished" datetime="2020-01-06T14:40:03+08:00">2020-01-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-19 17:08:40" itemprop="dateModified" datetime="2023-09-19T17:08:40+08:00">2023-09-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flume/" itemprop="url" rel="index">
                    <span itemprop="name">flume</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <img src="/2020/01/06/Flume%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E6%B5%B7%E9%87%8F%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F/cover.jpg" class="label">
<p><img src="Flume%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E6%B5%B7%E9%87%8F%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F/cover.jpg" alt=""></p>
<p><strong>hdfs数据格式有两种：可拆分的和不可拆分的<br>Avro是可拆分的</strong></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/01/06/Flume%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E6%B5%B7%E9%87%8F%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/06/Storm-Spark-Flink%E5%AF%B9%E6%AF%94%E5%8F%8A%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="郭富城">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郭富城的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/06/Storm-Spark-Flink%E5%AF%B9%E6%AF%94%E5%8F%8A%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/" class="post-title-link" itemprop="url">Storm-Spark-Flink对比及大数据技术选型</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-06 14:27:57" itemprop="dateCreated datePublished" datetime="2020-01-06T14:27:57+08:00">2020-01-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-19 17:08:42" itemprop="dateModified" datetime="2023-09-19T17:08:42+08:00">2023-09-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spark/" itemprop="url" rel="index">
                    <span itemprop="name">Spark</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这篇文章一开始通过单词计数的例子向大家展示大数据框架开发的不同，让大家对各个框架的架构和编写应用程序有初步的印象，在单词计数例子的对比中发现各个架构中一些初步的不同。</p>
<p>随后描述的是Storm/Jstorm在开发复杂应用时将会遇到的一些问题，有些容易解决，有些将会难以解决，这个时候怎么办，首先关注的是在Storm/Jstorm中如何处理这些问题，然后探讨为什么会存在这些问题，Spark/flink会不会存在同样的问题，经过比较，发现这些问题只在Storm/Jstorm中存在，这时候需要回归到框架模型，架构上进行分析。</p>
<p>然后我们会发现Storm/Jstorm在实现复杂功能（比如窗口机制）为什么比Spark更困难，Storm/Jstorm的支持SQL开发为什么还是处于实验状态，其实这些都已经由Storm/Jstorm的底层模型决定了。</p>
<p>同时文章还给出Storm/Jstorm与Spark开发成本上的对比，最后将给出Storm/Jstorm的适应场景。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/01/06/Storm-Spark-Flink%E5%AF%B9%E6%AF%94%E5%8F%8A%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/03/Elasticsearch%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="郭富城">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郭富城的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/03/Elasticsearch%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Elasticsearch环境配置及常用命令</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-03 08:46:01" itemprop="dateCreated datePublished" datetime="2020-01-03T08:46:01+08:00">2020-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-20 17:49:44" itemprop="dateModified" datetime="2023-09-20T17:49:44+08:00">2023-09-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">elasticsearch</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
           <a id="more"></a>

<h3 id="系统环境配置"><a href="#系统环境配置" class="headerlink" title="系统环境配置"></a>系统环境配置</h3><ol>
<li><p>/etc/sysctl.conf</p>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_file_descriptors_and_mmap.html" target="_blank" rel="noopener">https://www.elastic.co/guide/cn/elasticsearch/guide/current/_file_descriptors_and_mmap.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count&#x3D;655360   #增加虚拟内存</span><br></pre></td></tr></table></figure>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/heap-sizing.html" target="_blank" rel="noopener">https://www.elastic.co/guide/cn/elasticsearch/guide/current/heap-sizing.html</a></p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.swappiness &#x3D; 1	    	#永久关闭内存交换或设置为1</span><br></pre></td></tr></table></figure>
<p>执行以下命令，确保生效配置生效：<br>sysctl -p</p>
<ol start="2">
<li><p>/etc/security/limits.conf<br> #增加以下参数</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/max-number-threads-check.html#max-number-threads-check" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/max-number-threads-check.html#max-number-threads-check</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* soft nofile 655360    	 #增加打开文件数</span><br><span class="line">* hard nofile 655360 		   #增加打开文件数</span><br><span class="line">* soft nproc unlimited     #增加创建线程数</span><br><span class="line">* hard nproc unlimited     #增加创建线程数</span><br><span class="line">* soft memlock unlimited   #锁定内存不限制</span><br><span class="line">* hard memlock unlimited   #锁定内存不限制</span><br></pre></td></tr></table></figure></li>
<li><p>查看某用户下最多可以运行多少线程，命令:ulimit -u</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@bigdata-03 ~]$ ulimit -u</span><br><span class="line">4096</span><br></pre></td></tr></table></figure></li>
<li><p>线程数设置不生效，再更改以下文件</p>
<p>/etc/security/limits.d/20-nproc.conf </p>
</li>
</ol>
<p>​       /etc/security/limits.d/90-nproc.conf</p>
<p>  #增加以下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* soft nproc 6553600</span><br><span class="line">* hard nproc 6553600</span><br></pre></td></tr></table></figure>
<p>查看打开文件数（当发现打开文件数不足时，可以用命令查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -u hnivory |wc -l</span><br></pre></td></tr></table></figure>
<h3 id="elasticsearch-yml配置"><a href="#elasticsearch-yml配置" class="headerlink" title="elasticsearch.yml配置"></a>elasticsearch.yml配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: es-cluster</span><br><span class="line">node.name: node1</span><br><span class="line">http.cors.enabled: true </span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br><span class="line">cluster.routing.allocation.same_shard.host: true</span><br><span class="line">bootstrap.memory_lock: true</span><br><span class="line">xpack.ml.enabled: false</span><br><span class="line">#action.destructive_requires_name: true</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;192.168.8.101:9300&quot;, &quot;192.168.8.103:9300&quot;, &quot;192.168.8.104:9300&quot;]  </span><br><span class="line">#这个参数控制的是，一个节点需要看到的具有master节点资格的最小数量，然后才能在集群中做操作。官方的推荐值是(N&#x2F;2)+1，其中N是具有master资格的节点的数量</span><br><span class="line">discovery.zen.minimum_master_nodes: 2 </span><br><span class="line">#控制集群在达到多少个节点之后才会开始数据恢复,通过这个设置可以避免集群自动相互发现的初期,shard分片不全的问题,假如es集群内一共有5个节点,就可以设置为5,那么这个集群必须有5个节点启动后才会开始数据分片,如果设置为3,就有可能另外两个节点没存储数据分片</span><br><span class="line">#gateway.recover_after_nodes: 1</span><br><span class="line">#初始化数据恢复的超时时间,假如gateway.recover_after_nodes参数设置为5,就是5个节点全部启动后,再过5分钟开始数据恢复</span><br><span class="line">#gateway.recover_after_time: 5m</span><br><span class="line">#启动几个节点后开始数据恢复,假如gateway.recover_after_nodes这个参数设置为5,那么等到这5个节点全部启动后直接可以数据恢复,不用等待gateway.recover_after_time设置的时间</span><br><span class="line">#gateway.expected_nodes: 2</span><br><span class="line">举例来说，对于一个有10个data node的集群，如果有以下的设置:</span><br><span class="line">#gateway.expected_data_nodes: 10</span><br><span class="line">#gateway.recover_after_time: 5m</span><br><span class="line">#gateway.recover_after_data_nodes: 8</span><br><span class="line">那么集群5分钟以内10个data node都加入了，或者5分钟以后8个以上的data node加入了，都会立即启动recovery过程。</span><br><span class="line">#配置在每轮ping操作中等待DNS查找的时间。这被指定为时间单位，默认为5秒。。</span><br><span class="line">#discovery.zen.ping.unicast.resolve_timeout</span><br><span class="line">#（默认为30s）确定节点将多久决定开始选举或加入现有的群集之前等待</span><br><span class="line"># discovery.zen.ping_timeout: 30s</span><br><span class="line">#How often a node gets pinged. Defaults to 1s.</span><br><span class="line">#ping_interval</span><br><span class="line">#How long to wait for a ping response, defaults to 30s.</span><br><span class="line">#ping_timeout</span><br><span class="line">#How many ping failures &#x2F; timeouts cause a node to be considered failed. Defaults to 3.</span><br><span class="line">#ping_retries</span><br><span class="line">#控制fielddata允许内存大小，达到HEAP 40% 自动清理旧cache</span><br><span class="line">#indices.fielddata.cache.size: 40%</span><br><span class="line">#防止同一个shard的主副本存在同一个物理机上（因为如果存在一个机器上，副本的高可用性就没有了</span><br><span class="line">#cluster.routing.allocation.same_shard.host:true</span><br><span class="line">#但仍允许os在紧急情况下发生交换。对于大部分Linux操作系统，可以在sysctl 中这样配置：#vm.swappiness &#x3D; 1，</span><br><span class="line">#临时修改sysctl vm.swappiness&#x3D;1 ， 永久修改，vi &#x2F;etc&#x2F;sysctl.conf  在这个文档的最后加上这样一行:vm.swappiness&#x3D;1,保存，重启</span><br><span class="line">#如果上面的方法都不能做到，你需要打开配置文件中的mlockall开关，它的作用就是运行JVM锁住内存，禁止OS交换出去。在elasticsearch.yml配置如下：bootstrap.mlockall: true</span><br></pre></td></tr></table></figure>

<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>停止和开启分片分配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -X PUT localhost:9200&#x2F;_cluster&#x2F;settings &#123;&quot;persistent&quot;:&#123;&quot;cluster.routing.allocation.enable&quot;:&quot;none&quot;&#125;&#125;</span><br><span class="line">curl -u admin:admin -X PUT localhost:9200&#x2F;_cluster&#x2F;settings &#123;&quot;persistent&quot;:&#123;&quot;cluster.routing.allocation.enable&quot;:&quot;all&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>同步副本分片，刷新到磁盘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST http:&#x2F;&#x2F;127.0.0.1:9200&#x2F;_flush&#x2F;synced</span><br></pre></td></tr></table></figure>
<p>索引段强制合并为1个(<em>通配符表示全部，也可以具体的索引和其它通配符索引)，*</em>该操作会占用大量资源**，慎重操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPOST http:&#x2F;&#x2F;localhost:9200&#x2F;*&#x2F;_forcemerge?max_num_segments&#x3D;1</span><br></pre></td></tr></table></figure>
<p>统计节点个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_cat&#x2F;nodes  |wc-l</span><br></pre></td></tr></table></figure>
<p>获取节点状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_nodes&#x2F;stats?pretty</span><br></pre></td></tr></table></figure>
<p>查看索引分片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET http:&#x2F;&#x2F;localhost:9200&#x2F;_cat&#x2F;shards&#x2F;indexname</span><br></pre></td></tr></table></figure>
<p>设置节点离开重新分配时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  _all&#x2F;_settings PUT</span><br><span class="line">  &#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index.unassigned.node_left.delayed_timeout&quot;: &quot;15m&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看集群待处理任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_cluster&#x2F;pending_tasks</span><br></pre></td></tr></table></figure>
<p>最大文件描述符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_nodes&#x2F;stats&#x2F;process?filter_path&#x3D;**.max_file_descriptors</span><br></pre></td></tr></table></figure>
<p>关闭/开启监控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;_cluster&#x2F;settings   -H &#39;Content-Type: application&#x2F;json&#39; -d&#39;&#123;&quot;persistent&quot;: &#123;&quot;xpack.monitoring.collection.enabled&quot;: false&#125;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>模糊设置副本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;*-20191127&#x2F;_settings -H &#39;Content-Type:application&#x2F;json&#39;  -d&#39;&#123;&quot;index&quot;:&#123;&quot;number_of_replicas&quot;:0&#125;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>排除节点(根据ip,节点名称)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;_cluster&#x2F;settings  -H &#39;Content-Type: application&#x2F;json&#39; -d &#39;&#123;&quot;transient&quot;:&#123;&quot;cluster.routing.allocation.exclude._ip&quot;:&quot;10.159.102.43&quot;&#125;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>停止排除节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;_cluster&#x2F;settings  -H &#39;Content-Type: application&#x2F;json&#39; -d &#39;&#123;&quot;transient&quot;:&#123;&quot;cluster.routing.allocation.exclude._ip&quot;:&quot;&quot;&#125;&#125;&#39;</span><br><span class="line">curl -u admin:admin -XPUT localhost:9200&#x2F;_cluster&#x2F;settings  -H &#39;Content-Type: application&#x2F;json&#39; -d &#39;&#123;&quot;transient&quot;:&#123;&quot;cluster.routing.allocation.exclude._name&quot;:&quot;&quot;&#125;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>查看磁盘分片分配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin localhost:9200&#x2F;_cluster&#x2F;allocation&#x2F;explain?pretty</span><br></pre></td></tr></table></figure>
<p>查看该节点任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_cat&#x2F;tasks</span><br></pre></td></tr></table></figure>
<p>查看节点任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -XGET localhost:9200&#x2F;_tasks?nodes&#x3D;esnode_10.159.102.45_9200</span><br><span class="line">  &#123;&quot;nodes&quot;:&#123;&quot;YKhjmEw6TP2d-VDCyxCvNA&quot;:&#123;&quot;name&quot;:&quot;esnode_10.159.102.45_9202&quot;,&quot;transport_address&quot;:&quot;10.159.102.45:9302&quot;,&quot;host&quot;:&quot;10.159.102.45&quot;,&quot;ip&quot;:&quot;10.159.102.45:9302&quot;,&quot;roles&quot;:[&quot;master&quot;,&quot;data&quot;,&quot;ingest&quot;],&quot;attributes&quot;:&#123;&quot;xpack.installed&quot;:&quot;true&quot;&#125;,&quot;tasks&quot;:&#123;&quot;YKhjmEw6TP2d-VDCyxCvNA:90113856&quot;:&#123;&quot;node&quot;:&quot;YKhjmEw6TP2d-VDCyxCvNA&quot;,&quot;id&quot;:90113856,&quot;type&quot;:&quot;netty&quot;,&quot;action&quot;:&quot;cluster:monitor&#x2F;tasks&#x2F;lists[n]&quot;,&quot;start_time_in_millis&quot;:1574855877228,&quot;running_time_in_nanos&quot;:541054,&quot;cancellable&quot;:false,&quot;parent_task_id&quot;:&quot;3WMnBj-pTNegdkT19ao5nQ:11035209&quot;,&quot;headers&quot;:&#123;&#125;&#125;&#125;&#125;&#125;&#125;[hnivory@data01 ~]</span><br></pre></td></tr></table></figure>
<p>取消任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin localhost:9200&#x2F;_tasks&#x2F;YKhjmEw6TP2d-VDCyxCvNA:90113856&#x2F;_cancel</span><br></pre></td></tr></table></figure>
<p>取消节点任务和某类型的任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_tasks&#x2F;_cancel?nodes&#x3D;esnode_10.159.102.43_9202,esnode_10.159.102.43_9203,esnode_10.159.102.43_9204,esnode_10.159.102.43_9205,&amp;actions&#x3D;cluster:*</span><br><span class="line">_tasks&#x2F;_cancel?nodes&#x3D;esnode_10.159.102.45_9202&amp;actions&#x3D;cluster:*   POST</span><br><span class="line">_tasks&#x2F;_cancel?nodes&#x3D;esnode_10.159.102.45_9202&amp;actions&#x3D;*reindex    POST</span><br></pre></td></tr></table></figure>
<p> 查看节点任务和某类型的任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_tasks?nodes&#x3D;esnode_10.159.102.45_9202&amp;actions&#x3D;cluster:*  GET</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/03/Elasticsearch%E4%BB%8B%E7%BB%8D(%E5%9B%9B)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="郭富城">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郭富城的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/03/Elasticsearch%E4%BB%8B%E7%BB%8D(%E5%9B%9B)/" class="post-title-link" itemprop="url">Elasticsearch介绍(四)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-03 08:46:01" itemprop="dateCreated datePublished" datetime="2020-01-03T08:46:01+08:00">2020-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-19 17:08:40" itemprop="dateModified" datetime="2023-09-19T17:08:40+08:00">2023-09-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">elasticsearch</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>上一节介绍elasticsearch的插件，包括head, kibnan, ik分词,searchguard。</p>
<p>本节主要介绍elasticsearch的系统环境配置，es配置和一些操作和优化命令</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/01/03/Elasticsearch%E4%BB%8B%E7%BB%8D(%E5%9B%9B)/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/03/Elasticsearch%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="郭富城">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郭富城的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/03/Elasticsearch%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/" class="post-title-link" itemprop="url">Elasticsearch常见问题及解决办法</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-03 08:46:01" itemprop="dateCreated datePublished" datetime="2020-01-03T08:46:01+08:00">2020-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-20 17:49:33" itemprop="dateModified" datetime="2023-09-20T17:49:33+08:00">2023-09-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">elasticsearch</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
           <a id="more"></a>

<h2 id="常见问题及解决办法"><a href="#常见问题及解决办法" class="headerlink" title="常见问题及解决办法"></a>常见问题及解决办法</h2><h5 id="打开文件数过多Too-many-open-files"><a href="#打开文件数过多Too-many-open-files" class="headerlink" title="打开文件数过多Too many open files"></a>打开文件数过多Too many open files</h5><p>解决办法：<br> 1.修改系统参数，增加最大文件数</p>
<h5 id="出现red索引"><a href="#出现red索引" class="headerlink" title="出现red索引"></a>出现red索引</h5><p>解决办法：<br> 1.查看unassigned分片(没有生成副本导致unassigned状态不在此列），获取unassigned的索引和分片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin http:&#x2F;&#x2F;192.168.199.101:9200&#x2F;_cat&#x2F;shards |grep UNASSIGNED</span><br><span class="line">shsnc-snc_redis_rule_data 0 p UNASSIGNED                             </span><br><span class="line">shsnc-snc_redis_rule_data 0 r UNASSIGNED </span><br><span class="line"></span><br><span class="line">索引是shsnc-snc_redis_rule_data,分片0主副分片未分配</span><br></pre></td></tr></table></figure>

<p>2.查询得到master节点的唯一标识符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin  http:&#x2F;&#x2F;192.168.199.101:9200&#x2F;_cat&#x2F;master?v</span><br><span class="line">id                     host            ip              node</span><br><span class="line">WACuWE4UTcSWWxAEKHbwUg 192.168.199.101 192.168.199.101 es192.168.199.101_1</span><br></pre></td></tr></table></figure>

<p>3重新路由reroute </p>
<p>3.1根据索引index和分片shard 先尝试恢复数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin  -H &quot;Content-Type: application&#x2F;json&quot; -XPOST &#39;http:&#x2F;&#x2F;192.168.199.101:9200&#x2F;_cluster&#x2F;reroute?pretty&#39; -d &#39;&#123;&quot;commands&quot;:[&#123;&quot;allocate_stale_primary&quot;:&#123;&quot;index&quot;:&quot;shsnc-snc_redis_rule_data&quot;,&quot;shard&quot;:0,&quot;node&quot;:&quot;KOSdc1s0T661o9xgsEHHBQ&quot;,&quot;accept_data_loss&quot;:true&#125;&#125;]&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>3.2如果不能恢复，则创建空主分片，使索引恢复GREEN状态 （节点id要求是数据节点）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:admin -H &#39;Content-Type:application&#x2F;json&#39; -XPOST  &#39;http:&#x2F;&#x2F;192.168.199.101:9200&#x2F;_cluster&#x2F;reroute?pretty&#39; -d &#39;&#123;&quot;commands&quot;:[&#123;&quot;allocate_empty_primary&quot;:&#123;&quot;index&quot;:&quot;shsnc-snc_redis_rule_data&quot;,&quot;shard&quot;:0,&quot;node&quot;:&quot;WACuWE4UTcSWWxAEKHbwUg&quot;,&quot;accept_data_loss&quot;:true&#125;&#125;]&#125;&#39;</span><br></pre></td></tr></table></figure>



<h5 id="超过单个字段最大长度32766"><a href="#超过单个字段最大长度32766" class="headerlink" title="超过单个字段最大长度32766"></a>超过单个字段最大长度32766</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ava.lang.IllegalArgumentException: Document contains at least one immense term in field&#x3D;&quot;groupTemplateValue&quot; </span><br><span class="line">(whose UTF8 encoding is longer than the max length 32766), all of which were skipped.  Please correct the analyzer </span><br><span class="line">to not produce such terms.  The prefix of the first immense term is: &#39;[102, 114, 111, 109, 32, 58, 32, 42, 32, 44, 10, </span><br><span class="line">42, 32, 58, 32, 36, 78, 85, 77, 32, 44, 10, 98, 111, 111, 108, 32, 58, 32, 123]...&#39;, original message: bytes can be at most </span><br><span class="line">32766 in length; got 102464</span><br></pre></td></tr></table></figure>
<p>分析：此问题仅对keyword类型字段<br>解决办法：<br>1.更换字段类型为text,<br>2.添加ignore_above设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;raw_message&quot;: &#123;</span><br><span class="line">&quot;ignore_above&quot;: 10000,</span><br><span class="line">&quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="任务超出队列-拒绝请求"><a href="#任务超出队列-拒绝请求" class="headerlink" title="任务超出队列,拒绝请求"></a>任务超出队列,拒绝请求</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error&quot;:&#123;&quot;root_cause&quot;:[&#123;&quot;type&quot;:&quot;es_rejected_execution_exception&quot;,&quot;reason&quot;:&quot;rejected execution of org.elasticsearch.transport.TransportService$7@215f2351 on EsThreadPoolExecutor[name &#x3D; node-0&#x2F;bulk, queue capacity &#x3D; 200, org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor@587b75c[Running, pool size &#x3D; 32, active threads &#x3D; 32, queued tasks &#x3D; 200, completed tasks &#x3D; 98211]]&quot;&#125;],&quot;type&quot;:&quot;es_rejected_execution_exception&quot;,&quot;reason&quot;:&quot;rejected execution of org.elasticsearch.transport.TransportService$7@215f2351 on EsThreadPoolExecutor[name &#x3D; node-0&#x2F;bulk, queue capacity &#x3D; 200,</span><br></pre></td></tr></table></figure>
<p>默认值是200，可设置参数<br>thread_pool.write.queue_size: 1000<br>调参数是临时解决办法，需要扩容集群</p>
<h5 id="新加入机器到集群时，写入倾斜到新集群"><a href="#新加入机器到集群时，写入倾斜到新集群" class="headerlink" title="新加入机器到集群时，写入倾斜到新集群"></a>新加入机器到集群时，写入倾斜到新集群</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">The cluster-level shard allocator tries to spread the shards of a single index across as many nodes as possible. However, depending on how many shards and indices you have, and how big they are, it may not always be possible to spread shards evenly.</span><br><span class="line"></span><br><span class="line">The following *dynamic* setting allows you to specify a hard limit on the total number of shards from a single index allowed per node:</span><br><span class="line"></span><br><span class="line">    index.routing.allocation.total_shards_per_node</span><br><span class="line"></span><br><span class="line">  The maximum number of shards (replicas and primaries) that will be allocated to a single node. Defaults to unbounded.</span><br><span class="line"></span><br><span class="line">You can also limit the amount of shards a node can have regardless of the index:</span><br><span class="line"></span><br><span class="line">    cluster.routing.allocation.total_shards_per_node</span><br><span class="line"></span><br><span class="line">  The maximum number of shards (replicas and primaries) that will be allocated to a single node globally. Defaults to unbounded (-1).</span><br><span class="line"></span><br><span class="line">These settings impose a hard limit which can result in some shards not being allocated.</span><br><span class="line">  Use with caution.</span><br></pre></td></tr></table></figure>
<p>索引级别设置：单个机器上分配该索引多少个分片，默认无限制<br>集群级别设置：单个机器上总分片数，默认无限制<br>注意：设置不合理，可能导致分片无法分配，比如索引有10个分片，只有2个es节点，如果设置单个节点该索引最大值为3，就会导致该索引分片无法分配</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-total-shards.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-total-shards.html</a></p>
<h5 id="模糊查询导致堆栈溢出"><a href="#模糊查询导致堆栈溢出" class="headerlink" title="模糊查询导致堆栈溢出"></a>模糊查询导致堆栈溢出</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> asiainfo-ceshizhibiao-* <span class="keyword">where</span> cpu <span class="keyword">like</span> <span class="string">'%在迪士尼乐园，点亮心中奇梦。它是一个充满创造力、冒险精神与无穷精彩的快地。您可在此游览全球最大的迪士%'</span> </span><br><span class="line">DSL</span><br><span class="line">&#123;<span class="string">"from"</span>:<span class="number">0</span>,<span class="string">"size"</span>:<span class="number">1000</span>,<span class="string">"query"</span>:&#123;<span class="string">"bool"</span>:&#123;<span class="string">"filter"</span>:[&#123;<span class="string">"bool"</span>:&#123;<span class="string">"must"</span>:[&#123;<span class="string">"wildcard"</span>:&#123;<span class="string">"cpu"</span>:&#123;<span class="string">"wildcard"</span>:<span class="string">"*在迪士尼乐园，点亮心中奇梦。它是一个充满创造力、冒险精神与无穷精彩的快地。您可在此游览全球最大的迪士*"</span>,<span class="string">"boost"</span>:<span class="number">1.0</span>&#125;&#125;&#125;],<span class="string">"adjust_pure_negative"</span>:<span class="literal">true</span>,<span class="string">"boost"</span>:<span class="number">1.0</span>&#125;&#125;],<span class="string">"adjust_pure_negative"</span>:<span class="literal">true</span>,<span class="string">"boost"</span>:<span class="number">1.0</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>like中字段太长，导致堆栈溢出，目前like限制在30个字节</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[2017-06-14T21:06:39,330][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [xx.xx.xx.xx] fatal error in thread [elasticsearch[xx.xx.xx.xx][search][T#29]], exiting</span><br><span class="line">java.lang.StackOverflowError</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br><span class="line">at org.apache.lucene.util.automaton.Operations.isFinite(Operations.java:1053) ~[lucene-core-6.2.1.jar:6.2.1 43ab70147eb494324a1410f7a9f16a896a59bc6f - shalin - 2016-09-15 05:15:20]</span><br></pre></td></tr></table></figure>
<h5 id="出现Can-not-be-imported-as-a-dangling-index-异常"><a href="#出现Can-not-be-imported-as-a-dangling-index-异常" class="headerlink" title="出现Can not be imported as a dangling index 异常"></a>出现Can not be imported as a dangling index 异常</h5><p><a href="https://discuss.elastic.co/t/how-to-resolve-dangling-indices-error-on-each-index/130609/11" target="_blank" rel="noopener">https://discuss.elastic.co/t/how-to-resolve-dangling-indices-error-on-each-index/130609/11</a><br>1.找到索引对应的uuid，<br>2.在报错的es节点上删除对应的本地存储nodes/0/indices/{uuid}文件</p>
<p><img src="/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp" alt=""></p>
<p><img src="Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch9.bmp" alt=""></p>
<h5 id="出现Insufficient-buffer-remaining-for-AEAD-cipher-fragment-2-Needs-to-be-more-than-tag-size-16-异常"><a href="#出现Insufficient-buffer-remaining-for-AEAD-cipher-fragment-2-Needs-to-be-more-than-tag-size-16-异常" class="headerlink" title="出现Insufficient buffer remaining for AEAD cipher fragment (2). Needs to be more than tag size (16) 异常"></a>出现Insufficient buffer remaining for AEAD cipher fragment (2). Needs to be more than tag size (16) 异常</h5><p><img src="/images/Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch10.bmp" alt=""><br><img src="Elasticsearch%E4%BB%8B%E7%BB%8D/elasticsearch10.bmp" alt=""></p>
<p><a href="https://github.com/tkohegyi/mitmJavaProxy/issues/12" target="_blank" rel="noopener">https://github.com/tkohegyi/mitmJavaProxy/issues/12</a><br><a href="https://bugs.openjdk.org/browse/JDK-8221218" target="_blank" rel="noopener">https://bugs.openjdk.org/browse/JDK-8221218</a><br>今天es故障出现的原因是OpenJDK触发的bug，现在有两种处理方式，<br>一是继续观察，看后续还会不会触发，不触发就不用改，<br>二是更改jdk，更改jdk需要集群全量重启，更改jdk后会不会导致其它问题，也无法预测，目前集群gc已经很频繁，更改jdk也可能导致集群gc不过来出现内存溢出，目前更改jdk的风险比较高。<br>所以建议还是继续保持现状，做到再次遇到这种情况快速恢复，同时采集一些降低集群压力的措施（包括减少数据，延长刷新时间，查询方面等）,因为也有集群是采用的OpenJDK并没有出现这个bug。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%89%B9%E7%82%B9%E5%8F%8A%E9%80%89%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="郭富城">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郭富城的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%89%B9%E7%82%B9%E5%8F%8A%E9%80%89%E5%9E%8B/" class="post-title-link" itemprop="url">大数据存储特点及选型</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-03 08:46:01" itemprop="dateCreated datePublished" datetime="2020-01-03T08:46:01+08:00">2020-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-19 18:04:14" itemprop="dateModified" datetime="2023-09-19T18:04:14+08:00">2023-09-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/" itemprop="url" rel="index">
                    <span itemprop="name">大数据存储</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>介绍数据有哪些类型，数据存储有什么特点，数据存储的方式和模型。还探讨分布式存储的特点，分布式存储的方式，分区和副本的作用，分布式数据中数据倾斜问题，最后判断数据存储选型的依据及数据存储的未来。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%89%B9%E7%82%B9%E5%8F%8A%E9%80%89%E5%9E%8B/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6Flink,Spark,Storm,Hadoop%E6%AF%94%E8%BE%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="郭富城">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="郭富城的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6Flink,Spark,Storm,Hadoop%E6%AF%94%E8%BE%83/" class="post-title-link" itemprop="url">大数据框架Flink,Spark,Storm,Hadoop比较</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-03 08:46:01" itemprop="dateCreated datePublished" datetime="2020-01-03T08:46:01+08:00">2020-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-20 17:49:03" itemprop="dateModified" datetime="2023-09-20T17:49:03+08:00">2023-09-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/" itemprop="url" rel="index">
                    <span itemprop="name">大数据存储</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Flink-Spark-Storm-Hadoop大数据框架比较"><a href="#Flink-Spark-Storm-Hadoop大数据框架比较" class="headerlink" title="Flink,Spark,Storm,Hadoop大数据框架比较"></a>Flink,Spark,Storm,Hadoop大数据框架比较</h2><p><strong>摘要</strong><br>每天，大数据分析作为一种用于分析大量按需数据的工具，越来越受到人们的欢迎。四个最常见的大数据处理框架包括Apache Hadoop，Apache Spark，Apache Storm和Apache Flink。虽然这四个都支持大数据处理，但是这些框架的用法和支持该用法的基础体系结构不同。许多研究已经投入了时间和精力来通过评估已定义的关键绩效指标（KPI）来比较这些大数据框架。本文通过确定一组通用的关键性能指标来总结这些早期工作，这些关键性能指标包括处理时间，CPU消耗，延迟，吞吐量，执行时间，可持续的输入速率，任务性能，可伸缩性和容错能力，并比较这四个大数据通过文献综述了解这些KPI的框架。<strong>与Apache Hadoop和Apache Storm框架相比，在非实时数据中Spark为多个KPI（包括处理时间，CPU消耗，延迟，执行时间，任务性能和可伸缩性）的赢家。在流处理中Flink与Apache Spark和Apache Storm框架相比，Flink在处理时间，CPU消耗，延迟，吞吐量，执行时间，任务性能，可伸缩性和容错能力方面最适合流处理。</strong></p>
<p><strong>关键字-大数据，性能评估，Flink，Hadoop，Spark，Storm</strong></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/01/03/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6Flink,Spark,Storm,Hadoop%E6%AF%94%E8%BE%83/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="郭富城"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">郭富城</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">147</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">111</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/gxianch" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gxianch" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/%E5%8F%91%E9%82%AE%E4%BB%B6%E8%87%B3:g.xian.ch@gmail.com" title="E-Mail → 发邮件至:g.xian.ch@gmail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://book4you.org/" title="https:&#x2F;&#x2F;book4you.org&#x2F;" rel="noopener" target="_blank">ZLibrary</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.banshujiang.cn/" title="http:&#x2F;&#x2F;www.banshujiang.cn&#x2F;" rel="noopener" target="_blank">banshujiang</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.packtpub.com/tech" title="https:&#x2F;&#x2F;www.packtpub.com&#x2F;tech" rel="noopener" target="_blank">packtpub</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.manning.com/" title="https:&#x2F;&#x2F;www.manning.com&#x2F;" rel="noopener" target="_blank">manning</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://coolshell.cn/" title="https:&#x2F;&#x2F;coolshell.cn&#x2F;" rel="noopener" target="_blank">coolshell</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">郭富城</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
